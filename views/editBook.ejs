<!--
  @file editBook.ejs
  @description BeeReader - Edit Book Page
               This page allows users to update an existing book entry.
               Users can modify title, author, year, genre, and optionally upload a new cover image.
  @created 2025-06-09
-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!-- Responsive settings for mobile devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Shared layout and custom styling -->
    <link rel="stylesheet" href="/css/index.css" />
    <link rel="stylesheet" href="/css/addNewBook.css" />

    <!-- Page title (populated via EJS) -->
    <title><%= title|| "Edit Book - BeeReader" %></title>
  </head>

  <body>
    <!-- ===== Site Header ===== -->
    <header class="heading">
      <div class="site-name">BeeReader</div>
      <img src="/images/logo.png" alt="BeeReader Logo" />
    </header>

    <!-- ===== Main Content ===== -->
    <main class="main-content">
      <div class="form-case">
        <h1>Edit Book</h1>

        <!-- 
        Edit form for book.
        Uses FormData and fetch() to send PUT request with possible image upload.
      -->
        <form
          id="book-form"
          action="/api/books"
          method="POST"
          enctype="multipart/form-data"
        >
          <!-- Book ID (hidden) -->
          <input type="hidden" name="id" id="id" value="<%= data.id %>" />

          <!-- Book Title -->
          <div>
            <label for="title">Title:</label>
            <input
              type="text"
              name="title"
              id="title"
              value="<%= data.title %>"
              required
            />
          </div>

          <!-- Author -->
          <div>
            <label for="author">Author:</label>
            <input
              type="text"
              name="author"
              id="author"
              value="<%= data.author %>"
              required
            />
          </div>

          <!-- Publication Year -->
          <div>
            <label for="year">Year:</label>
            <input
              type="number"
              name="year"
              id="year"
              value="<%= data.year %>"
              required
              min="1000"
              max="2100"
            />
          </div>
          <!-- Optional Genre -->
          <div>
            <label for="genre">Genre:</label>
            <input
              type="text"
              name="genre"
              id="genre"
              value="<%= data.genre || '' %>"
            />
          </div>

          <!-- Optional new cover image -->
          <div>
            <label for="cover">Cover Image:</label>
            <input type="file" name="cover" id="cover" accept="image/*" />
            <% if (data.image_url) { %>
            <p id="cover-path">Current cover: <%= data.image_url %></p>
            <img
              id="cover-preview"
              src="<%= data.image_url %>"
              alt="Current cover image"
              style="max-width: 120px"
            />
            <% } %>
          </div>

          <!-- Hidden field to preserve original image if not replaced -->
          <input
            type="hidden"
            name="existingCover"
            value="<%= data.image_url %>"
          />

          <!-- Save button -->
          <button type="submit" class="text-btn">Save</button>
        </form>
      </div>
    </main>

    <!-- ===== Client-side Script ===== -->
    <script>
      window.BASE_URL =
        "<%= process.env.NODE_ENV === 'production' ? 'https://beereader-node.onrender.com' : 'http://localhost:3000' %>";
    </script>
    <script>
       // Expose the id to global scope
      window.bookData = <%- JSON.stringify(data) %>; // Inject server-rendered data
    </script>
    <script src="/js/editBook.js"></script>
  </body>
</html>

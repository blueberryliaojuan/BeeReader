<!--
  File: profile.ejs
  Description: Profile page for BeeReader users, allowing them to view and update personal information,
               including name, phone number, address, and profile picture.
  Author: Juan Liao
  Created: 2025-07-15
  Dependencies: 
    - profile.js (handles client-side validation and form submission)
    - /css/index.css, /css/profile.css (styling)
    - Express EJS rendering (server-side template variables like <%= user %>)
  Notes:
    - This page uses server-rendered values to pre-fill user data.
    - Form uses multipart/form-data to support image upload.
    - Avatar and user data are updated via API (/api/users/updateProfile/:id).
-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- ====== Fonts and Stylesheets ====== -->
    <link
      href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/css/index.css" />
    <link rel="stylesheet" href="/css/profile.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <title><%= title %></title>
  </head>

  <body>
    <!-- ====== Site Header (Logo + Name) ====== -->
    <header class="heading">
      <div class="site-name">BeeReader</div>
      <img src="/images/logo.png" alt="BeeReader Logo" />
    </header>

    <!-- ====== Main Layout Container ====== -->
    <main>
      <!-- ====== Sidebar Navigation ====== -->
      <nav class="sidebar">
        <div class="section">
          <!-- Library Link -->
          <a href="/library" class="menu-item" title="Library">
            <svg
              class="icon"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 7h18M3 12h18M3 17h18"
              />
            </svg>
            <span class="ml-2">Library</span>
          </a>

          <!-- Reading List Link -->
          <a href="/readingList" class="menu-item" title="Reading List">
            <svg
              class="icon"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 19.5A2.5 2.5 0 006.5 22H18a2 2 0 002-2V5a1 1 0 00-1-1H6.5A2.5 2.5 0 004 6.5v13zM8 8h8M8 12h8"
              />
            </svg>
            <span class="ml-2">Reading List</span>
          </a>

          <!-- Profile Link (Active Page) -->
          <a href="/profile" class="menu-item active" title="Profile">
            <svg
              class="icon"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0z"
              />
            </svg>
            <span class="ml-2">Profile</span>
          </a>
        </div>
      </nav>

      <!-- ====== Main Content Area ====== -->
      <div class="main-content">
        <div class="content-case">
          <!-- ====== Avatar and Logout Section ====== -->
          <div class="avatar-section container">
            <img
              id="avatar-image"
              src="<%= user && user.profile_picture ? user.profile_picture : '/images/userPic.png' %>"
              alt="User Avatar"
            />
            <div>
              <button class="text-btn" id="logout-btn">Log Out</button>
            </div>
          </div>

          <!-- ====== Profile Update Form ====== -->
          <div class="form-section container">
            <form
              id="profile-form"
              data-userid="<%= user.id %>"
              enctype="multipart/form-data"
            >
              <h2 class="form__title">Update Profile</h2>

              <!-- Email (Read-only) -->
              <div class="form-item">
                <label for="email">Email</label>
                <input
                  class="input"
                  id="email"
                  name="email"
                  type="email"
                  required
                  value="<%= user?.email ? user.email : '' %>"
                  readonly
                />
                <p class="error-message"></p>
              </div>

              <!-- Hidden field to preserve existing image -->
              <input
                type="hidden"
                name="existingImage"
                id="existingImage"
                value="<%= user.profile_picture %>"
              />

              <!-- Username Input -->
              <div class="form-item">
                <label for="name">User Name</label>
                <input
                  class="input"
                  id="name"
                  name="name"
                  type="text"
                  required
                  placeholder="Your full name"
                  value="<%= user?.username ? user.username : '' %>"
                />
                <p id="username-error" class="error-message"></p>
              </div>

              <!-- Profile Picture Upload -->
              <div class="form-item">
                <label for="profile_picture">Change Avatar</label>
                <input
                  class="input"
                  type="file"
                  id="profile_picture"
                  name="profile_picture"
                  accept="image/*"
                />
                <p id="profile_picture-error" class="error-message"></p>
              </div>

              <!-- Phone Input -->
              <div class="form-item">
                <label for="phone">Phone</label>
                <input
                  class="input"
                  id="phone"
                  name="phone"
                  type="tel"
                  placeholder="(123) 456-7890"
                  value="<%= user ? user.phone : '' %>"
                />
                <p id="phone-error" class="error-message"></p>
              </div>

              <!-- Address Input -->
              <div class="form-item">
                <label for="address">Address</label>
                <textarea
                  class="input"
                  id="address"
                  name="address"
                  placeholder="Your address"
                >
<%= user ? user.address : '' %></textarea
                >
                <p id="address-error" class="error-message"></p>
              </div>

              <!-- Submit Button -->
              <button class="text-btn" type="submit">Save Changes</button>
            </form>
          </div>
        </div>
      </div>
    </main>
    <script>
      window.BASE_URL =
        "<%= process.env.NODE_ENV === 'production' ? 'https://beereader-node.onrender.com' : 'http://localhost:3000' %>";
    </script>
    <!-- ====== Profile Logic (Validation & Submission) ====== -->
    <script type="module" src="/js/profile.js"></script>
  </body>
</html>
